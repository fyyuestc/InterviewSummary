[TOC]

# 红黑树总结

## 1. 二叉排序树

### 1.1 删除某节点

假设要删除的为结点 p，则对于二叉排序树来说，需要根据结点 p 所在不同的位置作不同的操作，有以下 3 种可能

1. 结点 p 为叶子结点，此时只需要删除该结点，并修改其双亲结点的指针即可；

2. 结点 p 只有左子树或者只有右子树，此时只需要将其左子树或者右子树直接变为结点 p 双亲结点的左子树即可；

3. 结点 p 左右子树都有，此时有两种处理方式：

   1）令结点 p 的左子树为其双亲结点的左子树；结点 p 的右子树为其自身直接前驱结点的右子树，如图1所示

   ![图1](http://data.biancheng.net/uploads/allimg/171016/2-1G016152R32b.png)

   <p aligh='left'>图1</p>

   2)  用结点 p 的直接前驱（或直接后继）来代替结点 p，同时在二叉排序树中对其直接前驱（或直接后继）做删除操作。如图2为使用直接前驱代替结点 p

   ![图2](http://data.biancheng.net/uploads/allimg/171016/2-1G016152T5W2.png)

   <center>图2</center>

## 2. 红黑树

红黑树本身就是一颗**二叉查找树**，树中没有一条路径比其他任何路径长出两倍，接近平衡状态。

![红黑树](http://data.biancheng.net/uploads/allimg/171206/2-1G2061610041F.png)

- 根结点是黑色
- 所有nil叶子结点为黑色
- 红色结点的两个孩子结点均为黑色 

> 结点的黑高度：从该结点到其子孙节点路径中包含的黑结点数



### 2.1 红黑树的旋转

当使用红黑树进行插入或者删除结点的操作时，可能会破坏红黑树的 5 条性质，从而变成了一棵普通树，此时就可以通过对树中的某些子树进行旋转，从而使整棵树重新变为一棵红黑树。

旋转操作分为左旋和右旋，同二叉排序树转平衡二叉树的旋转原理完全相同。例如图3表示的是对一棵二叉查找树中局部子树进行左旋和右旋操作：

![图3](http://data.biancheng.net/uploads/allimg/171206/2-1G2061613253H.png)

<center>图3</center>

**左旋**：如图3所示，左旋时 y 结点变为该部分子树的根结点，同时 x 结点（连同其左子树 a）移动至 y 结点的左孩子。若 y 结点有左孩子 b，由于 x 结点需占用其位置，所以调整至 x 结点的右孩子处。

**右旋**：如图3所示，同左旋是同样的道理，x 结点变为根结点，同时 y 结点连同其右子树 c 作为 x 结点的右子树，原 x 结点的右子树 b 变为 y 结点的左子树。



### 2.2 红黑树的插入新结点

当创建一个红黑树或者向已有红黑树中插入新的数据时，只需要按部就班地执行以下 3 步：

- 由于红黑树本身是一棵二叉查找树，所以在插入新的结点时，完全按照二叉查找树插入结点的方法，找到新结点插入的位置；
- 将新插入的结点结点初始化，颜色设置为红色后插入到指定位置；（将新结点初始化为红色插入后，不会破坏红黑树第 5 条的性质）
- 由于插入新的结点，可能会破坏红黑树第 4 条的性质（若其父结点颜色为红色，就破坏了红黑树的性质），此时需要调整二叉查找树，想办法通过旋转以及修改树中结点的颜色，使其重新成为红黑树！

---

插入结点的第 1 步和第 2 步都非常简单，关键在于最后一步对树的调整！在红黑树中插入结点时，根据插入位置的不同可分为以下 3 种情况：

1. 插入位置为整棵树的树根。处理办法：只需要将插入结点的颜色改为黑色即可。

2. 插入位置的双亲结点的颜色为黑色。处理方法：此种情况不需要做任何工作，新插入的颜色为红色的结点不会破坏红黑树的性质。

3. 插入位置的双亲结点的颜色为红色。处理方法：由于插入结点颜色为红色，其双亲结点也为红色，破坏了红黑树第 4 条性质，此时需要结合其祖父结点和祖父结点的另一个孩子结点（父结点的兄弟结点，此处称为“叔叔结点”）的状态，分为 3 种情况讨论:

   * 当前结点的父节点是红色，且“叔叔结点”也是红色：破坏了红黑树的第 4 条性质，解决方案为：将父结点颜色改为黑色；将叔叔结点颜色改为黑色；将祖父结点颜色改为红色；下一步将祖父结点认做当前结点，继续判断，处理结果如下图所示：

     ![](http://data.biancheng.net/uploads/allimg/171206/2-1G206161H4545.png)

   **分析**：此种情况下，由于父结点和当前结点颜色都是红色，所以为了不产生冲突，将父结点的颜色改为黑色。但是虽避免了破坏第 4 条，但是却导致该条路径上的黑高度增加了 1 ，破坏了第 5 条性质。但是在将祖父结点颜色改为红色、叔叔结点颜色改为黑色后，该部分子树没有破坏第 5 条性质。但是由于将祖父结点的颜色改变，还需判断是否破坏了上层树的结构，所以需要将祖父结点看做当前结点，继续判断。

   * 当前结点的父结点颜色为红色，叔叔结点颜色为黑色，且当前结点是父结点的右孩子。解决方案：将父结点作为当前结点做左旋操作。

     ![](http://data.biancheng.net/uploads/allimg/171206/2-1G206161K4648.png)

   **分析**：在进行以父结点为当前结点的左旋操作后，此种情况就转变成了第 3 种情况，处理过程跟第 3 种情况同步进行。

   * 当前结点的父结点颜色为红色，叔叔结点颜色为黑色，且当前结点是父结点的左孩子。解决方案：将父结点颜色改为黑色，祖父结点颜色改为红色，从祖父结点处进行右旋处理。如下图所示：

     ![](http://data.biancheng.net/uploads/allimg/171206/2-1G206161Q4636.png)

   **分析**：在此种情况下，由于当前结点 F 和父结点 S 颜色都为红色，违背了红黑树的性质 4，此时可以将 S 颜色改为黑色，有违反了性质 5，因为所有 通过 S 的路径其黑高度都增加了 1 ，所以需要将其祖父结点颜色设为红色后紧接一个右旋，这样这部分子树有成为了红黑树。（上图中的右图虽看似不是红黑树，但是只是整棵树的一部分，以 S 为根结点的子树一定是一棵红黑树）



### 2.3 红黑树删除结点

在二叉查找树删除结点时，分为 3 种情况：

- 若该删除结点本身是叶子结点，则可以直接删除；

- 若只有一个孩子结点（左孩子或者右孩子），则直接让其孩子结点顶替该删除结点；

- 若有两个孩子结点，则找到该结点的右子树中值最小的叶子结点来顶替该结点，然后删除这个值最小的叶子结点。

  

在红黑树中删除结点，思路更简单，只需要完成 2 步操作：

1. 将红黑树按照二叉查找树删除结点的方法删除指定结点；

2. 重新调整删除结点后的树，使之重新成为红黑树；（还是通过旋转和重新着色的方式进行调整）

   

以上情况最终都需要删除某个结点，此时需要判断删除该结点是否会破坏红黑树的性质。判断的依据是：

1. 如果删除结点的颜色为红色，则不会破坏；
2. 如果删除结点的颜色为黑色，则肯定会破坏红黑树的第 5 条性质，此时就需要对树进行调整，调整方案分 4 种情况讨论：

- 删除结点的兄弟结点颜色是红色，调整措施为：将兄弟结点颜色改为黑色，父亲结点改为红色，以父亲结点来进行左旋操作，同时更新删除结点的兄弟结点（左旋后兄弟结点发生了变化），如下图所示：
  

![](http://data.biancheng.net/uploads/allimg/171206/2-1G206162042Y4.png)

- 删除结点的兄弟结点及其孩子全部都是黑色的，调整措施为：将删除结点的兄弟结点设为红色，同时设置删除结点的父结点标记为新的结点，继续判断；
- 删除结点的兄弟结点是黑色，其左孩子是红色，右孩子是黑色。调整措施为：将兄弟结点设为红色，兄弟结点的左孩子结点设为黑色，以兄弟结点为准进行右旋操作，最终更新删除结点的兄弟结点；
- 删除结点的兄弟结点是黑色，其右孩子是红色（左孩子不管是什么颜色），调整措施为：将删除结点的父结点的颜色赋值给其兄弟结点，然后再设置父结点颜色为黑色，兄弟结点的右孩子结点为黑色，根据其父结点做左旋操作，最后设置替换删除结点的结点为根结点；



## 3. 总结

> 红黑树，虽隶属于二叉查找树，但是二叉查找树的时间复杂度会受到其树深度的影响，而红黑树可以保证在最坏情况下的时间复杂度仍为`O(lgn)`。当数据量多到一定程度时，使用红黑树比二叉查找树的效率要高。
>
> 同平衡二叉树相比较，红黑树没有像平衡二叉树对平衡性要求的那么苛刻，虽然两者的时间复杂度相同，但是红黑树在实际测算中的速度要更胜一筹！平衡二叉树的时间复杂度是`O(logn)`，红黑树的时间复杂度为`O(lgn)`，两者都表示的都是时间复杂度为对数关系（lg 函数为底是 10 的对数，用于表示时间复杂度时可以忽略）。








